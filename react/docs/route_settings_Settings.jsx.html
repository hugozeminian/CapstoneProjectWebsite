<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>route/settings/Settings.jsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AdminLogin">AdminLogin</a></li><li><a href="global.html#AvatarContainer">AvatarContainer</a></li><li><a href="global.html#Baptism">Baptism</a></li><li><a href="global.html#BoxCustom">BoxCustom</a></li><li><a href="global.html#ButtonAdminLogin">ButtonAdminLogin</a></li><li><a href="global.html#ButtonCustom">ButtonCustom</a></li><li><a href="global.html#ButtonCustomAdmin">ButtonCustomAdmin</a></li><li><a href="global.html#CalcDifViewHeigh">CalcDifViewHeigh</a></li><li><a href="global.html#CardContainerList">CardContainerList</a></li><li><a href="global.html#CardEticket">CardEticket</a></li><li><a href="global.html#CardService">CardService</a></li><li><a href="global.html#CarouselImages">CarouselImages</a></li><li><a href="global.html#CarouselTestimonials">CarouselTestimonials</a></li><li><a href="global.html#ContentContainer">ContentContainer</a></li><li><a href="global.html#CustomNotification">CustomNotification</a></li><li><a href="global.html#DateContainer">DateContainer</a></li><li><a href="global.html#DescriptionContainer">DescriptionContainer</a></li><li><a href="global.html#DeveloperLink">DeveloperLink</a></li><li><a href="global.html#FileInput">FileInput</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#FooterDevelopers">FooterDevelopers</a></li><li><a href="global.html#FooterHeightContext">FooterHeightContext</a></li><li><a href="global.html#FooterHeightProvider">FooterHeightProvider</a></li><li><a href="global.html#FooterReachOut">FooterReachOut</a></li><li><a href="global.html#Form">Form</a></li><li><a href="global.html#FormInput">FormInput</a></li><li><a href="global.html#FormSelector">FormSelector</a></li><li><a href="global.html#ImageText">ImageText</a></li><li><a href="global.html#IsMobile">IsMobile</a></li><li><a href="global.html#Item">Item</a></li><li><a href="global.html#LocalDataRepositoryOnlyContext">LocalDataRepositoryOnlyContext</a></li><li><a href="global.html#LocalDataRepositoryOnlyProvider">LocalDataRepositoryOnlyProvider</a></li><li><a href="global.html#Logo">Logo</a></li><li><a href="global.html#MobileAvatarContainer">MobileAvatarContainer</a></li><li><a href="global.html#MobileContentContainer">MobileContentContainer</a></li><li><a href="global.html#MobileDescriptionContainer">MobileDescriptionContainer</a></li><li><a href="global.html#MobileStyledAvatar">MobileStyledAvatar</a></li><li><a href="global.html#ModalServices">ModalServices</a></li><li><a href="global.html#ModalServicesHook">ModalServicesHook</a></li><li><a href="global.html#NavbarHeightContext">NavbarHeightContext</a></li><li><a href="global.html#NavbarHeightProvider">NavbarHeightProvider</a></li><li><a href="global.html#Navigation">Navigation</a></li><li><a href="global.html#PageTitle">PageTitle</a></li><li><a href="global.html#RoutesApp">RoutesApp</a></li><li><a href="global.html#SocialIcon">SocialIcon</a></li><li><a href="global.html#StateContext">StateContext</a></li><li><a href="global.html#StyledAvatar">StyledAvatar</a></li><li><a href="global.html#StyledImage">StyledImage</a></li><li><a href="global.html#StyledMobilePaper">StyledMobilePaper</a></li><li><a href="global.html#StyledPaper">StyledPaper</a></li><li><a href="global.html#TitleContainer">TitleContainer</a></li><li><a href="global.html#TokenContext">TokenContext</a></li><li><a href="global.html#UseFetchDataHook">UseFetchDataHook</a></li><li><a href="global.html#Wedding">Wedding</a></li><li><a href="global.html#YouTubeVideo">YouTubeVideo</a></li><li><a href="global.html#capitalizeFirstLetter">capitalizeFirstLetter</a></li><li><a href="global.html#decryptUserId">decryptUserId</a></li><li><a href="global.html#deepCopy">deepCopy</a></li><li><a href="global.html#encryptUserId">encryptUserId</a></li><li><a href="global.html#ensureArray">ensureArray</a></li><li><a href="global.html#extractVideoKey">extractVideoKey</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatTime">formatTime</a></li><li><a href="global.html#formattedDateToAPI">formattedDateToAPI</a></li><li><a href="global.html#formattedTimeToAPI">formattedTimeToAPI</a></li><li><a href="global.html#generateRandomChars">generateRandomChars</a></li><li><a href="global.html#getCurrentDateTime">getCurrentDateTime</a></li><li><a href="global.html#getIconByName">getIconByName</a></li><li><a href="global.html#getLabelOrNameOfObjItem">getLabelOrNameOfObjItem</a></li><li><a href="global.html#getLastReference">getLastReference</a></li><li><a href="global.html#isDateGreaterThanOrEqualToToday">isDateGreaterThanOrEqualToToday</a></li><li><a href="global.html#useFooterHeight">useFooterHeight</a></li><li><a href="global.html#useLocalDataRepositoryOnly">useLocalDataRepositoryOnly</a></li><li><a href="global.html#useNavbarHeight">useNavbarHeight</a></li><li><a href="global.html#usePageData">usePageData</a></li><li><a href="global.html#useStateContext">useStateContext</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">route/settings/Settings.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import { useStateContext } from "../../context/TokenContext.jsx";
import {
  CircularProgress,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Typography,
  Paper,
  Box,
  Container,
  Switch,
} from "@mui/material";
import * as api from "../../api/api.js";
import ButtonCustom from "../../components/button-custom/ButtonCustom.jsx";
import SocialIcon from "../../components/social-icon/SocialIcon.jsx";
import ModalServices from "../../components/modal-services/ModalServices.jsx";
import usePageData from "../../components/use-page-data-hook/UsePageDataHook.jsx";
import { pageNames, loadingText } from "../../repository/ApiParameters.js";
import { decryptUserId, getIconByName } from "../../util/generalFunctions.js";
import { SettingsObjectExample } from "../../repository/_exempleObject.js";
import FileInput from "../../components/file-input/FileInput.jsx";

/**
 * Settings component for managing user settings.
 * @returns {JSX.Element} Settings component.
 */
export default function Settings() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(false);
  const { user, setNotification } = useStateContext();
  const [userAux, setUserAux] = useState("");

  useEffect(() => {
    const initializeUser = async () => {
      try {
        const encryptedUserId = await localStorage.getItem("user");
        if (encryptedUserId) {
          const decryptedUserId = await decryptUserId(encryptedUserId);
          await setUserAux(decryptedUserId);
        }
      } catch (error) {
        console.error("Error initializing user:", error);
      }
    };

    initializeUser();
  }, [user, userAux]);

  useEffect(() => {
    getUsers();
  }, [userAux]);

  const page = pageNames.settings;

  const {
    FontAwesomeIcon,
    faSpinner,
    localDataRepositoryOnly,
    isMobile,
    calcDifViewHeigh,
    openModal,
    objContentModal,
    typeOfModal,
    toggleUpdateButtonModal,
    isObjField,
    toggleSwitch,
    handleToggleSwitch,
    handleOpenModal,
    handleCloseModal,
    handleOnChangeFieldsModal,
    handleOnChangeImagesModal,
    handleUpdateDateModal,
    pageContent,
    isLoading,
    error,
  } = usePageData(page, api.getSettings);

  const repository = localDataRepositoryOnly
    ? SettingsObjectExample
    : pageContent;
  const [content, setContent] = useState(repository);
  const [referenceLogo, setReferenceLogo] = useState(
    `settings_content-section1_settings-1`
  );
  const [logo, setLogo] = useState();

  useEffect(() => {
    const fetchData = async () => {
      try {
        const updatedLogo = await api.fetchGeneralCards();
        setLogo(updatedLogo.section1_settings[0].image_path);
      } catch (error) {
        console.error("Error fetching logo:", error);
      }
    };

    fetchData();
  }, [referenceLogo, userAux]);

  useEffect(() => {
    const repository = localDataRepositoryOnly
      ? SettingsObjectExample
      : pageContent;
    setContent(repository);
  }, [localDataRepositoryOnly, pageContent]);

  const [iconVisibility, setIconVisibility] = useState({});

  const handleChangeLogo = async (selectedFile) => {
    const newPartner = {
      page: page,
      section: "section1_settings",
      reference: referenceLogo,
      title: "",
      description: "",
      video: "",
      date_info: "",
      time_info: "",
      location_info: "",
      eticket_link: "",
      imagefile: selectedFile,
    };

    const formData = new FormData();

    for (const key in newPartner) {
      if (Object.hasOwnProperty.call(newPartner, key)) {
        formData.append(key, newPartner[key]);
      }
    }

    try {
      await api.updateGeneralCards(referenceLogo, formData);
      const updatedContent = await api.fetchGeneralCards(page);
      setContent(updatedContent);
    } catch (error) {
      console.error("Error creating new card:", error);
      throw error;
    } finally {
      window.location.reload();
    }
  };

  const initializeIconVisibility = (content) => {
    const initialState = {};
    if (content &amp;&amp; content.socialMedia) {
      content.socialMedia.forEach((social, index) => {
        initialState[index] = social.isIconVisible || false;
      });
    }
    return initialState;
  };

  useEffect(() => {
    if (content &amp;&amp; content.socialMedia) {
      setIconVisibility(initializeIconVisibility(content));
    }
  }, [content]);

  const toggleIconVisibility = (index) => {
    setIconVisibility((prevState) => {
      const updatedIconVisibility = { ...prevState };
      const updatedData = [...content.socialMedia];

      updatedData[index].isIconVisible = !updatedData[index].isIconVisible;

      setContent((prevContent) => ({
        ...prevContent,
        socialMedia: updatedData,
      }));

      updatedIconVisibility[index] = !prevState[index];
      return updatedIconVisibility;
    });
  };

  const getUsers = () => {
    setLoading(true);
    api
      .getUsers()
      .then((usersData) => {
        setLoading(false);
        setUsers(usersData.reverse());
      })
      .catch(() => {
        setLoading(false);
      });
  };

  const onDeleteClick = (user) => {
    if (!window.confirm("Are you sure you want to delete this user?")) {
      return;
    }
    api
      .deleteUser(user.id)
      .then(() => {
        setNotification("User was successfully deleted");
        getUsers();
      })
      .catch((error) => {
        console.error("Error deleting user:", error);
      });
  };

  const renderTable = () => (
    &lt;TableContainer component={Paper}>
      &lt;Table sx={{ minWidth: 650 }}>
        &lt;TableHead>
          &lt;TableRow>
            {["ID", "Name", "Email", "Create Date", "Actions"].map(
              (column, index) => (
                &lt;TableCell key={index}>
                  &lt;Typography variant="h7" color={"text.secondary"}>
                    {column}
                  &lt;/Typography>
                &lt;/TableCell>
              )
            )}
          &lt;/TableRow>
        &lt;/TableHead>
        &lt;TableBody>
          {loading ? (
            &lt;TableRow>
              &lt;TableCell colSpan={5} align="center">
                &lt;CircularProgress />
              &lt;/TableCell>
            &lt;/TableRow>
          ) : (
            users.map((user) => (
              &lt;TableRow key={user.id}>
                {Object.values(user).map((value, index) => (
                  &lt;TableCell key={index}>
                    &lt;Typography variant="h7" color={"text.secondary"}>
                      {value}
                    &lt;/Typography>
                  &lt;/TableCell>
                ))}
                &lt;TableCell>
                  &lt;ButtonCustom
                    label="Edit"
                    width="100px"
                    linkTo={`/users/${user.id}`}
                    disabled={
                      parseInt(userAux) !== 1 &amp;&amp;
                      parseInt(userAux) !== parseInt(user.id)
                    }
                  />

                  {user.id !== 1 &amp;&amp; (
                    &lt;ButtonCustom
                      onClick={() => onDeleteClick(user)}
                      label="Delete"
                      colorHover="text.error"
                      background="text.error"
                      borderColorHover="text.error"
                      ml={1}
                      width="100px"
                      disabled={parseInt(userAux) !== 1}
                    />
                  )}
                &lt;/TableCell>
              &lt;/TableRow>
            ))
          )}
        &lt;/TableBody>
      &lt;/Table>
    &lt;/TableContainer>
  );

  const renderContactMeObject = (settingsObjectContactMe, objKey) => {
    if (
      !Array.isArray(settingsObjectContactMe) ||
      settingsObjectContactMe.length === 0
    ) {
      return null;
    }

    return settingsObjectContactMe.map((data, index) => (
      &lt;Box
        key={index}
        p={1}
        display="flex"
        alignItems="center"
        width={"100%"}
        borderBottom="1px solid"
        borderColor={"secondary.main"}
      >
        &lt;Box flex="0 0 30px" mr={1}>
          &lt;SocialIcon
            socialIcon={getIconByName(data.icon, true)}
            href={data.link}
            width="30px"
            height="30px"
          />
        &lt;/Box>
        &lt;Box flex="1" marginLeft={4}>
          &lt;Typography>{data.link}&lt;/Typography>
        &lt;/Box>
        &lt;Box display={"flex"} flex="0 0 200px" justifyContent={"center"}>
          &lt;ButtonCustom
            width="130px"
            label="Edit"
            onClick={() => handleOpenModal(objKey, [data])}
          />
        &lt;/Box>
      &lt;/Box>
    ));
  };

  const renderSocialMediaObject = (settingsObjectSocialMedia, objKey) => {
    if (
      !Array.isArray(settingsObjectSocialMedia) ||
      settingsObjectSocialMedia.length === 0
    ) {
      return null;
    }

    return settingsObjectSocialMedia.map((data, index) => (
      &lt;Box
        key={index}
        p={1}
        display="flex"
        alignItems="center"
        width={"100%"}
        borderBottom="1px solid"
        borderColor={"secondary.main"}
      >
        &lt;Box flex="0 0 30px" mr={1}>
          &lt;SocialIcon
            socialIcon={getIconByName(data.icon)}
            href={data.link}
            width="30px"
            height="30px"
          />
        &lt;/Box>
        &lt;Box flex="1" marginLeft={4}>
          &lt;Typography>{data.link}&lt;/Typography>
        &lt;/Box>
        &lt;Box display={"flex"} flex="0 0 200px" justifyContent={"center"}>
          &lt;Switch
            checked={iconVisibility[index] || false}
            onChange={() => {
              toggleIconVisibility(index),
                handleToggleSwitch(
                  objKey,
                  [data],
                  [index],
                  settingsObjectSocialMedia
                );
            }}
          />
        &lt;/Box>
        &lt;Box display={"flex"} flex="0 0 200px" justifyContent={"center"}>
          &lt;ButtonCustom
            width="130px"
            label="Edit Link"
            onClick={() =>
              handleOpenModal(
                objKey,
                [data],
                [index],
                settingsObjectSocialMedia
              )
            }
          />
        &lt;/Box>
      &lt;/Box>
    ));
  };

  if (isLoading &amp;&amp; !localDataRepositoryOnly) {
    return (
      &lt;Container display="flex">
        &lt;Box
          display="flex"
          justifyContent="center"
          alignItems="center"
          sx={{
            minHeight:
              calcDifViewHeigh > window.innerHeight
                ? `70vh`
                : `calc(100vh - ${calcDifViewHeigh}px)`,
          }}
        >
          &lt;FontAwesomeIcon
            icon={faSpinner}
            spin
            style={{ marginRight: "0.5rem" }}
          />
          {loadingText.text}
        &lt;/Box>
      &lt;/Container>
    );
  }

  return (
    &lt;>
      {content &amp;&amp; (
        &lt;>
          &lt;Container
            sx={{
              height: "auto",
            }}
          >
            &lt;Box
              display="flex"
              flexDirection={"column"}
              justifyContent="center"
              alignItems="center"
              sx={{
                minHeight:
                  calcDifViewHeigh > window.innerHeight
                    ? "auto"
                    : `calc(100vh - ${calcDifViewHeigh}px)`,
              }}
            >
              &lt;Typography variant="h5">User List&lt;/Typography>
              &lt;Box
                display={"flex"}
                justifyContent={"space-between"}
                alignItems={"center"}
                width={"100%"}
              >
                &lt;Link to="/users/new">
                  &lt;ButtonCustom
                    label="Add New"
                    color="primary.main"
                    background="background.default"
                    border="2px solid"
                    borderColor="primary.main"
                    backgroundColorHover="primary.main"
                    borderColorHover="primary.main"
                    colorHover="primary.accent"
                  />
                &lt;/Link>
              &lt;/Box>
              &lt;Box width={"100%"} marginBottom={5}>
                {renderTable()}
              &lt;/Box>

              {/* Logo */}
              &lt;Box
                display={"flex"}
                justifyContent={"space-between"}
                alignItems={"center"}
                width={"100%"}
                marginTop={8}
              >
                &lt;Box
                  display="flex"
                  alignItems="center"
                  flexDirection={"column"}
                  width={"100%"}
                >
                  &lt;Typography variant="h5">My logo&lt;/Typography>
                  &lt;Box p={1} display="flex" alignItems="center" width={"100%"}>
                    &lt;Typography flex="1">Image&lt;/Typography>
                    &lt;Typography
                      display={"flex"}
                      flex="0 0 200px"
                      justifyContent={"center"}
                    >
                      Action
                    &lt;/Typography>
                  &lt;/Box>
                  &lt;Box
                    p={1}
                    display="flex"
                    alignItems="center"
                    justifyContent={"space-between"}
                    width={"100%"}
                    borderBottom="1px solid"
                    borderColor={"secondary.main"}
                  >
                    &lt;Box flex="0 0 30px" mr={1} width="30px" height="30px">
                      &lt;SocialIcon
                        socialIcon={logo}
                        href={"social.link"}
                        width="30px"
                        height="30px"
                      />
                    &lt;/Box>

                    &lt;Box
                      display={"flex"}
                      flex="0 0 200px"
                      justifyContent={"center"}
                    >
                      &lt;FileInput
                        onFileChange={handleChangeLogo}
                        index={0}
                        regularButtonShape={true}
                        width="130px"
                      />
                    &lt;/Box>
                  &lt;/Box>
                &lt;/Box>
              &lt;/Box>

              {/* Contact me */}
              &lt;Box
                display={"flex"}
                justifyContent={"space-between"}
                alignItems={"center"}
                width={"100%"}
                marginTop={8}
              >
                &lt;Box
                  display="flex"
                  alignItems="center"
                  flexDirection={"column"}
                  width={"100%"}
                >
                  &lt;Typography variant="h5">Contact me&lt;/Typography>
                  &lt;Box p={1} display="flex" alignItems="center" width={"100%"}>
                    &lt;Typography flex="0 0 30px">Icon&lt;/Typography>
                    &lt;Typography flex="1" marginLeft={4}>
                      Information
                    &lt;/Typography>
                    &lt;Typography
                      display={"flex"}
                      flex="0 0 200px"
                      justifyContent={"center"}
                    >
                      Action
                    &lt;/Typography>
                  &lt;/Box>

                  {renderContactMeObject(content.contactPhone, "contactPhone")}
                  {renderContactMeObject(content.contactEmail, "contactEmail")}
                  {renderContactMeObject(content.contactForm, "contactForm")}
                  {renderContactMeObject(content.blog, "blog")}
                &lt;/Box>
              &lt;/Box>

              {/* Social Networking */}
              &lt;Box
                display={"flex"}
                justifyContent={"space-between"}
                alignItems={"center"}
                width={"100%"}
                marginTop={8}
              >
                &lt;Box
                  display="flex"
                  alignItems="center"
                  flexDirection={"column"}
                  width={"100%"}
                >
                  &lt;Typography variant="h5">Social Media&lt;/Typography>
                  &lt;Box p={1} display="flex" alignItems="center" width={"100%"}>
                    &lt;Typography flex="0 0 30px">Icon&lt;/Typography>
                    &lt;Typography flex="1" marginLeft={4}>
                      Link
                    &lt;/Typography>
                    &lt;Typography
                      display={"flex"}
                      flex="0 0 200px"
                      justifyContent={"center"}
                    >
                      Visible
                    &lt;/Typography>
                    &lt;Typography
                      display={"flex"}
                      flex="0 0 200px"
                      justifyContent={"center"}
                    >
                      Action
                    &lt;/Typography>
                  &lt;/Box>

                  {renderSocialMediaObject(content.socialMedia, "socialMedia")}
                &lt;/Box>
              &lt;/Box>
            &lt;/Box>
          &lt;/Container>
          &lt;ModalServices
            open={openModal}
            onClose={handleCloseModal}
            obj={objContentModal}
            isObjField={isObjField}
            modalType={typeOfModal.adm}
            onChangeFields={handleOnChangeFieldsModal}
            onChangeImages={handleOnChangeImagesModal}
            updateButton={handleUpdateDateModal}
          />
        &lt;/>
      )}
    &lt;/>
  );
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Mon Apr 22 2024 04:18:28 GMT-0600 (Mountain Daylight Saving Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
